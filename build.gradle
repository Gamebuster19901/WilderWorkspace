plugins {
	id 'application'
	id 'java-library'
	id 'eclipse'
	id 'com.github.johnrengelman.shadow' version "7.1.0"
}

repositories {
    maven {
        url "https://maven.fabricmc.net"
    }
	mavenCentral()
}

version = workspaceVersion
group = "com.wildermods"
archivesBaseName = "wilderworkspace"

application {
	mainClass = 'com.wildermods.workspace.Main'
}

sourceCompatibility = '16'
targetCompatibility = '16'

dependencies { //For some reason, dependencies must be specified as shadow and implementation or dependencies will be missing at compile time, because fuck yoyu
	shadow group: 'cuchaz', name: 'enigma', version: enigmaVersion
	shadow group: 'cuchaz', name: 'enigma-cli', version: enigmaVersion
	shadow group: 'commons-io', name: 'commons-io', version: commonsIOVersion
	shadow group: 'org.apache.commons', name: 'commons-text', version: commonsTextVersion
	shadow group: 'com.google.code.gson', name: 'gson', version: gsonVersion
	implementation group: 'cuchaz', name: 'enigma', version: enigmaVersion
	implementation group: 'cuchaz', name: 'enigma-cli', version: enigmaVersion
	implementation group: 'commons-io', name: 'commons-io', version: commonsIOVersion
	implementation group: 'org.apache.commons', name: 'commons-text', version: commonsTextVersion
	implementation group: 'com.google.code.gson', name: 'gson', version: gsonVersion
}

import org.apache.tools.ant.filters.ReplaceTokens

task processSource(type: Sync) {
	from sourceSets.main.java
	inputs.property 'workspaceVersion', workspaceVersion
	inputs.property 'fabricLoaderVersion', fabricLoaderVersion
	inputs.property 'wilderLoaderVersion', wilderLoaderVersion
	inputs.property 'gameProviderVersion', gameProviderVersion
	inputs.property 'tinyMappingsVersion', tinyMappingsVersion
	inputs.property 'tinyRemapperVersion', tinyRemapperVersion
	inputs.property 'accessWidenerVersion', accessWidenerVersion
	inputs.property 'asmVersion', asmVersion
	inputs.property 'mixinVersion', mixinVersion
	inputs.property 'guavaVersion', guavaVersion
	inputs.property 'gsonVersion', gsonVersion
	inputs.property 'enigmaVersion', enigmaVersion
	inputs.property 'commonsTextVersion', commonsTextVersion
	inputs.property 'commonsIOVersion', commonsIOVersion
	
	filter(ReplaceTokens, tokens: [workspaceVersion: workspaceVersion, fabricLoaderVersion: fabricLoaderVersion,
		wilderLoaderVersion: wilderLoaderVersion, gameProviderVersion: gameProviderVersion, 
		tinyMappingsVersion: tinyMappingsVersion, tinyRemapperVersion: tinyRemapperVersion,
		accessWidenerVersion: accessWidenerVersion, asmVersion: asmVersion, mixinVersion: mixinVersion,
		guavaVersion: guavaVersion, gsonVersion: gsonVersion, enigmaVersion: enigmaVersion,
		commonsTextVersion: commonsTextVersion, commonsIOVersion: commonsIOVersion
	])
	into "$buildDir/src"
	
}

compileJava {
	source = processSource.outputs
}
